"use strict";exports.id=3117,exports.ids=[3117],exports.modules={43117:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A:()=>s});var e=c(21124),f=c(38301),g=c(39923),h=c(71876),i=c(94260),j=c(50207),k=c(78552),l=c(66088),m=c(81405),n=c(66518),o=c(86241),p=a([g,h]);[g,h]=p.then?(await p)():p;let q=[{value:"PIX",label:"PIX"},{value:"BOLETO",label:"Boleto"}],r=[{value:"PENDING",label:"Pendente"},{value:"APPROVED",label:"Aprovado"},{value:"CANCELLED",label:"Cancelado"}],s=({vendaFinal:a,vendaId:b,onSubmit:c,onCancel:d})=>{let[p,s]=(0,f.useState)({valor:Number(a?.valor)||0,status:a?.status||"PENDING",type:a?.type||"PIX",vencimento:a?.vencimento?new Date(a.vencimento):new Date,dataPagamento:a?.dataPagamento?new Date(a.dataPagamento):void 0,vendaId:b,id_payment:a?.id_payment||"",copiacola:a?.copiacola||"",qrcode:a?.qrcode||"",codigobarra:a?.codigobarra||"",gatewayId:a?.gatewayId||void 0,conexaoId:a?.conexaoId||void 0}),[t,u]=(0,f.useState)([]),[v,w]=(0,f.useState)([]),[x,y]=(0,f.useState)(!0),[z,A]=(0,f.useState)(!1),[B,C]=(0,f.useState)(a?.valor?(0,m.vv)(a.valor).replace("R$","").trim():"");(0,f.useEffect)(()=>{(async()=>{try{y(!0);let[a,b]=await Promise.all([g.k.list({limit:100}),h.J.list({limit:100})]);u(a.data||[]),w(b.data||[])}catch(a){console.error("Erro ao carregar dados:",a),n.oR.error("Erro ao carregar dados")}finally{y(!1)}})()},[]);let D=async a=>{if(a.preventDefault(),!p.valor||p.valor<=0)return void n.oR.error("Valor deve ser maior que zero");if(!p.vencimento)return void n.oR.error("Data de vencimento \xe9 obrigat\xf3ria");try{A(!0),await c(p)}catch(a){console.error("Erro ao salvar venda final:",a)}finally{A(!1)}};return(0,e.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"valor",children:"Valor *"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("span",{className:"absolute z-1 left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-300",children:"R$"}),(0,e.jsx)(j.A,{id:"valor",type:"text",className:"pl-9",value:B,onChange:a=>{let b=a.target.value.replace(/\D/g,"");if(""===b){C(""),s({...p,valor:0});return}let c=(0,m.F5)(b);C(c);let d=(0,m.h4)(b);console.log("Parsed Value:",d),s({...p,valor:d})},placeholder:"0,00",required:!0})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"status",children:"Status *"}),(0,e.jsx)(l.A,{id:"status",value:r.find(a=>a.value===p.status),onChange:a=>s({...p,status:a.value}),options:r,placeholder:"Selecione o status",required:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"type",children:"Tipo de Pagamento *"}),(0,e.jsx)(l.A,{id:"type",value:q.find(a=>a.value===p.type),onChange:a=>s({...p,type:a.value}),options:q,placeholder:"Selecione o tipo",required:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"vencimento",children:"Data de Vencimento *"}),(0,e.jsx)(o.A,{id:"data",onChange:a=>{a[0]&&s({...p,vencimento:a[0]})},defaultDate:new Date(p.vencimento||new Date)})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"dataPagamento",children:"Data do Pagamento"}),(0,e.jsx)(o.A,{id:"dataPagamento",onChange:a=>{a[0]?s({...p,dataPagamento:a[0]}):s({...p,dataPagamento:void 0})},defaultDate:p.dataPagamento?new Date(p.dataPagamento):void 0}),(0,e.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Data em que o pagamento foi efetivado (para status aprovado manualmente)"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"id_payment",children:"ID do Pagamento"}),(0,e.jsx)(j.A,{id:"id_payment",type:"text",value:p.id_payment||"",onChange:a=>s({...p,id_payment:a.target.value}),placeholder:"ID do pagamento (opcional)"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"gatewayId",children:"Gateway de Pagamento"}),(0,e.jsx)(l.A,{value:t.find(a=>a.id===p.gatewayId)?{value:p.gatewayId.toString(),label:t.find(a=>a.id===p.gatewayId).nome}:void 0,onChange:a=>{s({...p,gatewayId:a?parseInt(a.value):void 0})},options:t.map(a=>({value:a.id.toString(),label:`${a.nome} (${a.gateway}) ${a.isDefault?"(Padr\xe3o)":""}`})),placeholder:"Selecione um gateway (opcional)",isClearable:!0,isLoading:x})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"conexaoId",children:"Conex\xe3o WhatsApp"}),(0,e.jsx)(l.A,{value:v.find(a=>a.id===p.conexaoId)?{value:p.conexaoId.toString(),label:v.find(a=>a.id===p.conexaoId).nome}:void 0,onChange:a=>{s({...p,conexaoId:a?parseInt(a.value):void 0})},options:v.map(a=>({value:a.id.toString(),label:`${a.nome} ${a.isDefault?"(Padr\xe3o)":""}`})),placeholder:"Selecione uma conex\xe3o (opcional)",isClearable:!0,isLoading:x})]})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Dados de Pagamento (Opcionais)"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"copiacola",children:"Copia e Cola"}),(0,e.jsx)(j.A,{id:"copiacola",type:"text",value:p.copiacola||"",onChange:a=>s({...p,copiacola:a.target.value}),placeholder:"C\xf3digo copia e cola (opcional)"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"qrcode",children:"QR Code"}),(0,e.jsx)(j.A,{id:"qrcode",type:"text",value:p.qrcode||"",onChange:a=>s({...p,qrcode:a.target.value}),placeholder:"QR Code (opcional)"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(k.A,{htmlFor:"codigobarra",children:"C\xf3digo de Barra"}),(0,e.jsx)(j.A,{id:"codigobarra",type:"text",value:p.codigobarra||"",onChange:a=>s({...p,codigobarra:a.target.value}),placeholder:"C\xf3digo de barra (opcional)"})]})]})]}),(0,e.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[(0,e.jsx)("h4",{className:"font-medium text-blue-900 dark:text-blue-200 mb-2",children:"Informa\xe7\xf5es Importantes"}),(0,e.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-300 space-y-1",children:[(0,e.jsx)("li",{children:"• Campos obrigat\xf3rios: valor, status, type, vencimento e vendaId"}),(0,e.jsx)("li",{children:"• Os dados de pagamento s\xe3o opcionais e podem ser preenchidos posteriormente"}),(0,e.jsx)("li",{children:"• O status controla o estado atual da fatura"}),(0,e.jsx)("li",{children:"• O gateway \xe9 opcional e pode ser usado para integra\xe7\xe3o com sistemas de pagamento"})]})]}),(0,e.jsxs)("div",{className:"flex gap-3 pt-6",children:[(0,e.jsxs)(i.A,{type:"submit",variant:"primary",disabled:z,className:"flex-1",children:[z?"Salvando...":a?"Atualizar":"Criar"," Fatura"]}),d&&(0,e.jsx)(i.A,{type:"button",variant:"secondary",onClick:d,disabled:z,children:"Cancelar"})]})]})};d()}catch(a){d(a)}})}};