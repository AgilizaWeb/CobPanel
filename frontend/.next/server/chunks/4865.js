"use strict";exports.id=4865,exports.ids=[4865],exports.modules={47246:(e,a,t)=>{t.a(e,async(e,o)=>{try{t.d(a,{A:()=>j});var l=t(60687),r=t(43210),d=t(80022),i=t(83729),n=t(2643),s=t(55324),c=t(41721),m=t(70695),p=t(29908),v=t(37590),u=t(47876),x=e([d,i]);[d,i]=x.then?(await x)():x;let g=[{value:"PIX",label:"PIX"},{value:"BOLETO",label:"Boleto"}],h=[{value:"PENDING",label:"Pendente"},{value:"APPROVED",label:"Aprovado"},{value:"CANCELLED",label:"Cancelado"}],j=({vendaFinal:e,vendaId:a,onSubmit:t,onCancel:o})=>{let[x,j]=(0,r.useState)({valor:Number(e?.valor)||0,status:e?.status||"PENDING",type:e?.type||"PIX",vencimento:e?.vencimento?new Date(e.vencimento):new Date,dataPagamento:e?.dataPagamento?new Date(e.dataPagamento):void 0,vendaId:a,id_payment:e?.id_payment||"",copiacola:e?.copiacola||"",qrcode:e?.qrcode||"",codigobarra:e?.codigobarra||"",gatewayId:e?.gatewayId||void 0,conexaoId:e?.conexaoId||void 0}),[y,b]=(0,r.useState)([]),[A,f]=(0,r.useState)([]),[C,I]=(0,r.useState)(!0),[P,D]=(0,r.useState)(!1),[w,N]=(0,r.useState)(e?.valor?(0,p.vv)(e.valor).replace("R$","").trim():"");(0,r.useEffect)(()=>{(async()=>{try{I(!0);let[e,a]=await Promise.all([d.k.list({limit:100}),i.J.list({limit:100})]);b(e.data||[]),f(a.data||[])}catch(e){console.error("Erro ao carregar dados:",e),v.oR.error("Erro ao carregar dados")}finally{I(!1)}})()},[]);let S=async e=>{if(e.preventDefault(),!x.valor||x.valor<=0){v.oR.error("Valor deve ser maior que zero");return}if(!x.vencimento){v.oR.error("Data de vencimento \xe9 obrigat\xf3ria");return}try{D(!0),await t(x)}catch(e){console.error("Erro ao salvar venda final:",e)}finally{D(!1)}};return(0,l.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"valor",children:"Valor *"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("span",{className:"absolute z-1 left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-300",children:"R$"}),(0,l.jsx)(s.A,{id:"valor",type:"text",className:"pl-9",value:w,onChange:e=>{let a=e.target.value.replace(/\D/g,"");if(""===a){N(""),j({...x,valor:0});return}let t=(0,p.F5)(a);N(t);let o=(0,p.h4)(a);console.log("Parsed Value:",o),j({...x,valor:o})},placeholder:"0,00",required:!0})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"status",children:"Status *"}),(0,l.jsx)(m.A,{id:"status",value:h.find(e=>e.value===x.status),onChange:e=>j({...x,status:e.value}),options:h,placeholder:"Selecione o status",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"type",children:"Tipo de Pagamento *"}),(0,l.jsx)(m.A,{id:"type",value:g.find(e=>e.value===x.type),onChange:e=>j({...x,type:e.value}),options:g,placeholder:"Selecione o tipo",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"vencimento",children:"Data de Vencimento *"}),(0,l.jsx)(u.A,{id:"data",onChange:e=>{e[0]&&j({...x,vencimento:e[0]})},defaultDate:new Date(x.vencimento||new Date)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"dataPagamento",children:"Data do Pagamento"}),(0,l.jsx)(u.A,{id:"dataPagamento",onChange:e=>{e[0]?j({...x,dataPagamento:e[0]}):j({...x,dataPagamento:void 0})},defaultDate:x.dataPagamento?new Date(x.dataPagamento):void 0}),(0,l.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Data em que o pagamento foi efetivado (para status aprovado manualmente)"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"id_payment",children:"ID do Pagamento"}),(0,l.jsx)(s.A,{id:"id_payment",type:"text",value:x.id_payment||"",onChange:e=>j({...x,id_payment:e.target.value}),placeholder:"ID do pagamento (opcional)"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"gatewayId",children:"Gateway de Pagamento"}),(0,l.jsx)(m.A,{value:y.find(e=>e.id===x.gatewayId)?{value:x.gatewayId.toString(),label:y.find(e=>e.id===x.gatewayId).nome}:void 0,onChange:e=>{j({...x,gatewayId:e?parseInt(e.value):void 0})},options:y.map(e=>({value:e.id.toString(),label:`${e.nome} (${e.gateway}) ${e.isDefault?"(Padr\xe3o)":""}`})),placeholder:"Selecione um gateway (opcional)",isClearable:!0,isLoading:C})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"conexaoId",children:"Conex\xe3o WhatsApp"}),(0,l.jsx)(m.A,{value:A.find(e=>e.id===x.conexaoId)?{value:x.conexaoId.toString(),label:A.find(e=>e.id===x.conexaoId).nome}:void 0,onChange:e=>{j({...x,conexaoId:e?parseInt(e.value):void 0})},options:A.map(e=>({value:e.id.toString(),label:`${e.nome} ${e.isDefault?"(Padr\xe3o)":""}`})),placeholder:"Selecione uma conex\xe3o (opcional)",isClearable:!0,isLoading:C})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Dados de Pagamento (Opcionais)"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"copiacola",children:"Copia e Cola"}),(0,l.jsx)(s.A,{id:"copiacola",type:"text",value:x.copiacola||"",onChange:e=>j({...x,copiacola:e.target.value}),placeholder:"C\xf3digo copia e cola (opcional)"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"qrcode",children:"QR Code"}),(0,l.jsx)(s.A,{id:"qrcode",type:"text",value:x.qrcode||"",onChange:e=>j({...x,qrcode:e.target.value}),placeholder:"QR Code (opcional)"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.A,{htmlFor:"codigobarra",children:"C\xf3digo de Barra"}),(0,l.jsx)(s.A,{id:"codigobarra",type:"text",value:x.codigobarra||"",onChange:e=>j({...x,codigobarra:e.target.value}),placeholder:"C\xf3digo de barra (opcional)"})]})]})]}),(0,l.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-medium text-blue-900 dark:text-blue-200 mb-2",children:"Informa\xe7\xf5es Importantes"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-300 space-y-1",children:[(0,l.jsx)("li",{children:"• Campos obrigat\xf3rios: valor, status, type, vencimento e vendaId"}),(0,l.jsx)("li",{children:"• Os dados de pagamento s\xe3o opcionais e podem ser preenchidos posteriormente"}),(0,l.jsx)("li",{children:"• O status controla o estado atual da fatura"}),(0,l.jsx)("li",{children:"• O gateway \xe9 opcional e pode ser usado para integra\xe7\xe3o com sistemas de pagamento"})]})]}),(0,l.jsxs)("div",{className:"flex gap-3 pt-6",children:[(0,l.jsxs)(n.A,{type:"submit",variant:"primary",disabled:P,className:"flex-1",children:[P?"Salvando...":e?"Atualizar":"Criar"," Fatura"]}),o&&(0,l.jsx)(n.A,{type:"button",variant:"secondary",onClick:o,disabled:P,children:"Cancelar"})]})]})};o()}catch(e){o(e)}})}};