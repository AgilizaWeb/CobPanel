(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6716],{2395:(e,a,r)=>{"use strict";r.a(e,async(e,t)=>{try{r.d(a,{Q:()=>d});var o=r(9678),s=e([o]);o=(s.then?(await s)():s)[0];let d={create:async e=>(await o.FH.post("/cotacoes",e)).data,async list(e){let{page:a=1,limit:r=10,search:t=""}=e;return(await o.FH.get("/cotacoes",{params:{page:a,limit:r}})).data},getById:async e=>(await o.FH.get("/cotacoes/".concat(e))).data,update:async(e,a)=>(await o.FH.put("/cotacoes/".concat(e),a)).data,delete:async e=>(await o.FH.delete("/cotacoes/".concat(e))).data,getTotal:async()=>(await o.FH.get("/cotacoes/count/total")).data};t()}catch(e){t(e)}})},17329:(e,a,r)=>{"use strict";r.a(e,async(e,t)=>{try{r.d(a,{Z:()=>d});var o=r(9678),s=e([o]);o=(s.then?(await s)():s)[0];let d={create:async e=>(await o.FH.post("/cotacoes-items",e)).data,async list(){let{page:e=1,limit:a=9,search:r="",cotacaoId:t,aprovados:s,vencedores:d,produtoIds:c,fornecedorIds:l,orderBy:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await o.FH.get("/cotacoes-items",{params:{page:e,limit:a,search:r,cotacaoId:t,aprovados:s,vencedores:d,produtoIds:null==c?void 0:c.toString(),fornecedorIds:null==l?void 0:l.toString(),orderBy:i}})).data},getById:async e=>(await o.FH.get("/cotacoes-items/".concat(e))).data,update:async(e,a)=>(await o.FH.put("/cotacoes-items/".concat(e),a)).data,delete:async e=>(await o.FH.delete("/cotacoes-items/".concat(e))).data,getTotal:async()=>(await o.FH.get("/cotacoes-items/count/total")).data};t()}catch(e){t(e)}})},35220:(e,a,r)=>{"use strict";r.a(e,async(e,t)=>{try{r.d(a,{z:()=>d});var o=r(9678),s=e([o]);o=(s.then?(await s)():s)[0];let d={create:async e=>(await o.FH.post("/produtos",e)).data,async list(e){let{page:a=1,limit:r=10,search:t=""}=e;return(await o.FH.get("/produtos",{params:{page:a,limit:r,search:t}})).data},getById:async e=>(await o.FH.get("/produtos/".concat(e))).data,update:async(e,a)=>(await o.FH.put("/produtos/".concat(e),a)).data,delete:async e=>(await o.FH.delete("/produtos/".concat(e))).data,getTotal:async()=>(await o.FH.get("/produtos/count/total")).data};t()}catch(e){t(e)}})},55407:(e,a,r)=>{"use strict";r.a(e,async(e,t)=>{try{r.r(a),r.d(a,{default:()=>f});var o=r(95155),s=r(12115),d=r(22663),c=r(2395),l=r(17329),i=r(50412),n=r(68551),u=r(31166),m=r(94325),p=r(22851),v=r(43698),h=r(30304),x=r(73424),g=r(99145),y=r(40989),j=e([c,l,n]);function f(e){let{params:a}=e,{id:r}=(0,s.use)(a),[t,j]=(0,s.useState)(null),[f,b]=(0,s.useState)([]),[w,N]=(0,s.useState)(!0),[I,A]=(0,s.useState)(!1),[k,F]=(0,s.useState)(null),[S,C]=(0,s.useState)([]),[E,q]=(0,s.useState)([]),[H,z]=(0,s.useState)(1),[R,U]=(0,s.useState)(1),[P,M]=(0,s.useState)({}),[V,_]=(0,s.useState)(9),Q=(0,s.useCallback)(async()=>{try{N(!0);let e=await c.Q.getById(Number(r));j(e.data)}catch(e){d.oR.error("Erro ao carregar cota\xe7\xe3o")}},[r]),B=(0,s.useCallback)(async()=>{try{N(!0);let e=await l.Z.list({cotacaoId:Number(r),page:H,limit:V,aprovados:P.aprovados,vencedores:P.vencedores,produtoIds:P.produtoIds,fornecedorIds:P.fornecedorIds,orderBy:P.orderBy});b(e.data),U(e.pagination.pages)}catch(e){d.oR.error("Erro ao carregar itens")}finally{N(!1)}},[H,P,V,r]);(0,s.useEffect)(()=>{let e=(null==t?void 0:t.itens)||[];C(Array.from(new Map(e.filter(e=>e.produto).map(e=>[e.produto.id,e.produto])).values())),q(Array.from(new Map(e.filter(e=>e.fornecedor).map(e=>[e.fornecedor.id,e.fornecedor])).values())),console.log("itens:",e)},[t]),(0,s.useEffect)(()=>{Q(),B()},[Q,B]),(0,s.useEffect)(()=>{B()},[B]);let D=async e=>{try{k?(await l.Z.update(k.id,e),d.oR.success("Item atualizado com sucesso")):(await l.Z.create({...e,cotacaoId:Number(r)}),d.oR.success("Item adicionado com sucesso")),A(!1),F(null),Q(),B()}catch(e){d.oR.error("Erro ao salvar item")}},Z=async e=>{if(window.confirm("Tem certeza que deseja excluir este item?"))try{await l.Z.delete(e),d.oR.success("Item exclu\xeddo com sucesso"),Q(),B()}catch(e){d.oR.error("Erro ao excluir item")}},O=async e=>{try{await l.Z.update(e.id,{...e,aprovada:!e.aprovada}),d.oR.success("Item ".concat(e.aprovada?"desaprovado":"aprovado"," com sucesso")),B()}catch(e){console.error("Erro ao atualizar item:",e),d.oR.error("Erro ao atualizar item")}},T=async e=>{try{await l.Z.update(e.id,{...e,vencedora:!e.vencedora}),d.oR.success("Item ".concat(e.vencedora?"desmarcado":"marcado"," como vencedor")),B()}catch(e){d.oR.error("Erro ao atualizar item")}};return t?(0,o.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)(u.A,{variant:"secondary",size:"xs",onClick:()=>{window.history.back()},className:"mb-2 bg-transparent",children:[(0,o.jsx)(g.YJ,{className:"w-5 h-5"}),"Voltar"]}),(0,o.jsxs)("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:["Cota\xe7\xe3o #",t.id," - ",t.nome]}),(0,o.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Descri\xe7\xe3o - ",t.descricao]}),(0,o.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Data de Abertura: ",(0,m.Yq)(t.dataAbertura)," | Data de Fechamento: ",(0,m.Yq)(t.dataFechamento)]})]}),(0,o.jsx)("div",{className:"flex items-center gap-2",children:(0,o.jsx)(u.A,{variant:"primary",onClick:()=>{F(null),A(!0)},children:"Adicionar Item"})})]}),(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(h.A,{children:"Status"}),(0,o.jsx)(v.A,{isMulti:!0,options:[{value:"aprovados",label:"Aprovados"},{value:"vencedores",label:"Vencedores"}],onChange:e=>{M(a=>({...a,aprovados:null==e?void 0:e.some(e=>"aprovados"===e.value),vencedores:null==e?void 0:e.some(e=>"vencedores"===e.value)}))},placeholder:"Filtrar por status"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(h.A,{children:"Ordenar por"}),(0,o.jsx)(v.A,{options:[{value:"preco_asc",label:"Menor Pre\xe7o"},{value:"preco_desc",label:"Maior Pre\xe7o"},{value:"quantidade_asc",label:"Menor Quantidade"},{value:"quantidade_desc",label:"Maior Quantidade"}],onChange:e=>{let a=null==e?void 0:e.value;M(e=>({...e,orderBy:a}))},placeholder:"Ordenar por",isClearable:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(h.A,{children:"Produtos"}),(0,o.jsx)(v.A,{isMulti:!0,options:S.map(e=>({value:String(null==e?void 0:e.id),label:"".concat(null==e?void 0:e.nome," (").concat(null==e?void 0:e.sku,")")})),onChange:e=>{let a=(null==e?void 0:e.map(e=>Number(e.value)))||[];M(e=>({...e,produtoIds:a}))},placeholder:"Filtrar por produto"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)(h.A,{children:"Fornecedores"}),(0,o.jsx)(v.A,{isMulti:!0,options:E.map(e=>({value:String(null==e?void 0:e.id),label:null==e?void 0:e.nome})),onChange:e=>{let a=(null==e?void 0:e.map(e=>Number(e.value)))||[];M(e=>({...e,fornecedorIds:a}))},placeholder:"Filtrar por fornecedor"})]})]}),(0,o.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,o.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,o.jsx)(h.A,{className:"flex items-center mb-0 h-full",children:"Quantidade por pagina"}),(0,o.jsx)(y.A,{className:"max-w-24",defaultValue:V,max:f.length,min:1,onChange:e=>_(0|Number(e.target.value))})]}),(0,o.jsx)(x.A,{currentPage:H,totalPages:R,onPageChange:z})]})]})]}),w?(0,o.jsx)("div",{className:"grid gap-4",children:[1,2,3].map(e=>(0,o.jsx)("div",{className:"animate-pulse bg-gray-100 dark:bg-gray-800 rounded-lg h-24"},e))}):(0,o.jsx)("div",{className:"grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:f.length>0?f.map(e=>{var a,r,t;return(0,o.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md shadow-gray-200 dark:shadow-gray-700 border border-gray-200 dark:border-gray-700 p-4",children:(0,o.jsxs)("div",{className:"flex justify-between items-start flex-wrap",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{className:"font-medium text-gray-900 dark:text-white",children:[null==(a=e.produto)?void 0:a.nome," (",null==(r=e.produto)?void 0:r.sku,")"]}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:["Fornecedor: ",null==(t=e.fornecedor)?void 0:t.nome]}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:["Valor Unit\xe1rio: ",(0,m.vv)(Number(e.valorUnitario))," | Quantidade: ",e.quantidade]})]}),(0,o.jsxs)("div",{className:"flex gap-1 flex-wrap",children:[(0,o.jsx)(u.A,{variant:e.aprovada?"success":"secondary",size:"xs",onClick:()=>O(e),title:e.aprovada?"Desaprovar Item":"Aprovar Item",children:(0,o.jsx)(g.CE,{className:"w-4 h-4 overflow-hidden"})}),(0,o.jsx)(u.A,{variant:e.vencedora?"success":"secondary",size:"xs",onClick:()=>T(e),title:e.vencedora?"Desmarcar Vencedor":"Marcar Vencedor",children:(0,o.jsx)(g.j1,{className:"w-4 h-4 overflow-hidden"})}),(0,o.jsx)(p.A,{variant:"secondary",size:"xs",onClick:()=>{F(e),A(!0)},title:"Editar Item",icon:"edit"}),(0,o.jsx)(p.A,{title:"Excluir Item",icon:"delete",variant:"secondary",size:"xs",onClick:()=>Z(e.id)})]})]})},e.id)}):(0,o.jsx)("div",{className:"text-center py-12",children:(0,o.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhum item encontrado nesta cota\xe7\xe3o."})})}),(0,o.jsx)(i.a,{isOpen:I,onClose:()=>{A(!1),F(null)},className:"max-w-[800px] m-4",children:(0,o.jsxs)("div",{className:"no-scrollbar relative w-full overflow-y-auto rounded-3xl bg-white p-4 dark:bg-gray-900 lg:p-11",children:[(0,o.jsxs)("div",{className:"px-2 pr-14",children:[(0,o.jsx)("h4",{className:"mb-2 text-2xl font-semibold text-gray-800 dark:text-white/90",children:k?"Editar Item":"Novo Item"}),(0,o.jsx)("p",{className:"mb-6 text-sm text-gray-500 dark:text-gray-400 lg:mb-7",children:k?"Atualize as informa\xe7\xf5es do item.":"Preencha os dados para criar um novo item."})]}),(0,o.jsx)(n.A,{item:k||void 0,cotacaoId:Number(r),onSubmit:D,onCancel:()=>{A(!1),F(null)}})]})})]}):null}[c,l,n]=j.then?(await j)():j,t()}catch(e){t(e)}})},68551:(e,a,r)=>{"use strict";r.a(e,async(e,t)=>{try{r.d(a,{A:()=>h});var o=r(95155),s=r(12115),d=r(22663),c=r(40989),l=r(30304),i=r(31166),n=r(43698),u=r(35220),m=r(56350),p=r(94325),v=e([u,m]);[u,m]=v.then?(await v)():v;let h=e=>{let{item:a,cotacaoId:r,onSubmit:t,onCancel:v}=e,[h,x]=(0,s.useState)({fornecedorId:(null==a?void 0:a.fornecedorId)||0,produtoId:(null==a?void 0:a.produtoId)||0,cotacaoId:r,valorUnitario:(null==a?void 0:a.valorUnitario)||"0",quantidade:(null==a?void 0:a.quantidade)||1,aprovada:(null==a?void 0:a.aprovada)||!1,vencedora:(null==a?void 0:a.vencedora)||!1}),[g,y]=(0,s.useState)([]),[j,f]=(0,s.useState)([]),[b,w]=(0,s.useState)(!0),[N,I]=(0,s.useState)({}),[A,k]=(0,s.useState)(!1),[F,S]=(0,s.useState)((null==a?void 0:a.valorUnitario)?(0,p.vv)(Number(a.valorUnitario)).replace("R$","").trim():"");(0,s.useEffect)(()=>{C(),E()},[]);let C=async()=>{try{w(!0);let e=await u.z.list({page:1,limit:100});y(e.data)}catch(e){d.oR.error("Erro ao carregar produtos")}finally{w(!1)}},E=async()=>{try{w(!0);let e=await m.P.list({page:1,perPage:100});f(e.data)}catch(e){d.oR.error("Erro ao carregar fornecedores")}finally{w(!1)}},q=async e=>{if(e.preventDefault(),(()=>{let e={};return["fornecedorId","produtoId","valorUnitario","quantidade"].forEach(a=>{h[a]||(e[a]="".concat(a.charAt(0).toUpperCase()+a.slice(1)," \xe9 obrigat\xf3rio"))}),h.quantidade<1&&(e.quantidade="Quantidade deve ser maior que zero"),0>=Number(h.valorUnitario)&&(e.valorUnitario="Valor unit\xe1rio deve ser maior que zero"),I(e),0===Object.keys(e).length})()){k(!0);try{await t(h)}catch(e){d.oR.error("Erro ao salvar item da cota\xe7\xe3o")}finally{k(!1)}}};return(0,o.jsxs)("form",{onSubmit:q,className:"space-y-6",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)(l.A,{htmlFor:"produtoId",children:["Produto",(0,o.jsx)("span",{className:"text-error-500",children:"*"})]}),(0,o.jsx)(n.A,{id:"produtoId",name:"produtoId",value:g.filter(e=>e.id===h.produtoId).map(e=>({value:e.id.toString(),label:"".concat(e.nome," (").concat(e.sku,")")}))[0],options:g.map(e=>({value:e.id.toString(),label:"".concat(e.nome," (").concat(e.sku,")")})),onChange:e=>{e&&x({...h,produtoId:Number(e.value)})},isSearchable:!0,placeholder:"Selecione um produto",error:N.produtoId})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)(l.A,{htmlFor:"fornecedorId",children:["Fornecedor",(0,o.jsx)("span",{className:"text-error-500",children:"*"})]}),(0,o.jsx)(n.A,{id:"fornecedorId",name:"fornecedorId",value:j.filter(e=>e.id===h.fornecedorId).map(e=>({value:e.id.toString(),label:e.nome}))[0],options:j.map(e=>({value:e.id.toString(),label:e.nome})),onChange:e=>{e&&x({...h,fornecedorId:Number(e.value)})},isSearchable:!0,placeholder:"Selecione um fornecedor",error:N.fornecedorId})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)(l.A,{htmlFor:"valorUnitario",children:["Valor Unit\xe1rio",(0,o.jsx)("span",{className:"text-error-500",children:"*"})]}),(0,o.jsx)(c.A,{id:"valorUnitario",name:"valorUnitario",value:F,onChange:e=>{let a=e.target.value.replace(/\D/g,""),r=parseInt(a)/100;S((0,p.vv)(r).replace("R$","").trim()),x({...h,valorUnitario:r.toFixed(2)})},error:N.valorUnitario,className:"pl-8"})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)(l.A,{htmlFor:"quantidade",children:["Quantidade",(0,o.jsx)("span",{className:"text-error-500",children:"*"})]}),(0,o.jsx)(c.A,{id:"quantidade",name:"quantidade",type:"number",min:"1",value:h.quantidade,onChange:e=>x({...h,quantidade:Number(e.target.value)}),error:N.quantidade})]}),(0,o.jsxs)("div",{className:"col-span-2 flex gap-4",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{title:"Item Aprovado",type:"checkbox",id:"aprovada",checked:h.aprovada,onChange:e=>x({...h,aprovada:e.target.checked}),className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"}),(0,o.jsx)(l.A,{htmlFor:"aprovada",className:"ml-2 mb-0",children:"Item Aprovado"})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{title:"Proposta Vencedora",type:"checkbox",id:"vencedora",checked:h.vencedora,onChange:e=>x({...h,vencedora:e.target.checked}),className:"w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500"}),(0,o.jsx)(l.A,{htmlFor:"vencedora",className:"ml-2 mb-0",children:"Proposta Vencedora"})]})]})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,o.jsx)(i.A,{variant:"secondary",onClick:v,type:"button",children:"Cancelar"}),(0,o.jsx)(i.A,{variant:"primary",type:"submit",loading:A,children:a?"Atualizar":"Adicionar"})]})]})};t()}catch(e){t(e)}})},78442:(e,a,r)=>{Promise.resolve().then(r.bind(r,55407))}},e=>{e.O(0,[3598,2663,5889,7750,4691,5938,8441,1255,7358],()=>e(e.s=78442)),_N_E=e.O()}]);