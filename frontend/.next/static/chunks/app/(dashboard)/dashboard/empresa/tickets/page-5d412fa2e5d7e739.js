(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1183],{14829:(e,a,l)=>{"use strict";l.a(e,async(e,s)=>{try{l.r(a),l.d(a,{default:()=>N});var t=l(95155),i=l(12115),r=l(35695),o=l(13568),c=l(37354),d=l(30353),n=l(60852),u=l(21913),v=l(12241),m=l(58277),p=l(86061),x=l(6112),h=l(44856),g=l(53780),b=l(66681),f=e([p,x,h,b]);function N(){let e=(0,r.useRouter)(),{user:a}=(0,b.A)(),[l,s]=(0,i.useState)([]),[f,N]=(0,i.useState)(!0),[j,k]=(0,i.useState)(""),[w,A]=(0,i.useState)(1),[y,E]=(0,i.useState)(0),[C,S]=(0,i.useState)({}),[T,R]=(0,i.useState)(20),[P,O]=(0,i.useState)(!1),[M,D]=(0,i.useState)(null),[I,_]=(0,i.useState)(!1),[B,U]=(0,i.useState)(!1),F=(0,i.useCallback)(async()=>{try{var e;N(!0);let a={page:w,perPage:T,search:j||void 0};C.status&&(a.status=C.status),C.tipo&&(a.tipo=C.tipo),C.prioridade&&(a.prioridade=C.prioridade);let l=await p.$p.ticket.list(a);s(l.data||[]),E((null===(e=l.pagination)||void 0===e?void 0:e.totalPages)||1)}catch(e){console.error("Erro ao carregar tickets:",e),o.oR.error("Erro ao carregar tickets")}finally{N(!1)}},[w,C,T,j]);(0,i.useEffect)(()=>{F()},[F]);let L=e=>{S(a=>({...a,...e})),A(1)},$=e=>{D(e),_(!1),O(!0)},G=a=>{e.push("/dashboard/empresa/tickets/".concat(a.id))},V=async e=>{if(window.confirm("Tem certeza que deseja excluir este ticket?"))try{await p.$p.ticket.delete(e.id),o.oR.success("Ticket exclu\xeddo com sucesso"),F()}catch(e){var a,l;o.oR.error((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Erro ao excluir ticket")}},z=async(e,l)=>{U(!0);try{M?(null==a?void 0:a.role)==="SUPERADMIN"&&(await p.$p.ticket.update(M.id,{status:e.status,prioridade:e.prioridade}),o.oR.success("Ticket atualizado com sucesso")):(await p.$p.ticket.create(e,l),o.oR.success("Ticket criado com sucesso")),O(!1),F()}catch(e){var s,t;o.oR.error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)||"Erro ao salvar ticket")}finally{U(!1)}},H=[{value:"",label:"Todos"},{value:"ABERTO",label:"Aberto"},{value:"EM_ANDAMENTO",label:"Em Andamento"},{value:"RESOLVIDO",label:"Resolvido"},{value:"FECHADO",label:"Fechado"}],q=[{value:"",label:"Todos"},{value:"PROBLEMA",label:"Problema"},{value:"AJUDA",label:"Ajuda"},{value:"MELHORIA",label:"Melhoria"},{value:"SUGESTAO",label:"Sugest\xe3o"}],J=[{value:"",label:"Todas"},{value:"BAIXA",label:"Baixa"},{value:"MEDIA",label:"M\xe9dia"},{value:"ALTA",label:"Alta"},{value:"URGENTE",label:"Urgente"}];return(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Tickets"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Gerencie seus tickets de suporte"})]}),(0,t.jsx)(n.A,{variant:"primary",onClick:()=>{D(null),_(!0),O(!0)},startIcon:(0,t.jsx)(g.c1,{className:"w-5 h-5"}),"aria-label":"Criar novo ticket",children:"Novo Ticket"})]}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[(0,t.jsx)("div",{className:"flex-1 w-full sm:max-w-xs",children:(0,t.jsx)(c.A,{type:"text",placeholder:"Buscar tickets...",value:j,onChange:e=>{k(e.target.value),A(1)},className:"w-full","aria-label":"Buscar tickets"})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsx)(d.A,{placeholder:"Status",options:H.filter(e=>""!==e.value),value:H.find(e=>e.value===(C.status||"")),onChange:e=>L({status:(null==e?void 0:e.value)||void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por status"}),(0,t.jsx)(d.A,{placeholder:"Tipo",options:q.filter(e=>""!==e.value),value:q.find(e=>e.value===(C.tipo||"")),onChange:e=>L({tipo:(null==e?void 0:e.value)||void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por tipo"}),(0,t.jsx)(d.A,{placeholder:"Prioridade",options:J.filter(e=>""!==e.value),value:J.find(e=>e.value===(C.prioridade||"")),onChange:e=>L({prioridade:(null==e?void 0:e.value)||void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por prioridade"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsx)(v.A,{className:"flex items-center mb-0 h-full",children:"Quantidade por p\xe1gina"}),(0,t.jsx)(c.A,{className:"max-w-24",defaultValue:T,max:100,min:1,onChange:e=>{let a=Number(e.target.value)||9;R(a),A(1)},"aria-label":"Itens por p\xe1gina"})]}),y>1&&(0,t.jsx)(u.A,{currentPage:w,totalPages:y,onPageChange:A})]})]})]}),f?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"animate-pulse bg-gray-100 dark:bg-gray-800 rounded-lg h-48"},e))}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.length>0?l.map(e=>(0,t.jsx)(x.A,{ticket:e,onView:()=>G(e),onEdit:(null==a?void 0:a.role)==="SUPERADMIN"?()=>$(e):void 0,onDelete:()=>V(e)},e.id)):(0,t.jsx)("div",{className:"col-span-full text-center py-12",children:(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhum ticket encontrado. Crie um novo ticket para come\xe7ar!"})})}),y>1&&(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)("div",{className:"flex justify-end mb-4 gap-2 flex-wrap",children:(0,t.jsx)(u.A,{currentPage:w,totalPages:y,onPageChange:A})})}),(0,t.jsx)(m.a,{isOpen:P,onClose:()=>{O(!1),D(null),_(!1)},className:"max-w-2xl m-4",children:(0,t.jsx)("div",{className:"no-scrollbar relative w-full overflow-y-auto rounded-3xl bg-white p-4 dark:bg-gray-900 lg:p-11",children:(0,t.jsxs)("div",{className:"px-2 pr-14",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:I?"Novo Ticket":"Editar Ticket"}),(0,t.jsx)(h.A,{ticket:M||null,onSubmit:z,onCancel:()=>{O(!1),D(null),_(!1)},loading:B})]})})})]})}[p,x,h,b]=f.then?(await f)():f,s()}catch(e){s(e)}})},89397:(e,a,l)=>{Promise.resolve().then(l.bind(l,14829))}},e=>{var a=a=>e(e.s=a);e.O(0,[8122,3568,9688,6980,4691,4349,5527,8441,1684,7358],()=>a(89397)),_N_E=e.O()}]);