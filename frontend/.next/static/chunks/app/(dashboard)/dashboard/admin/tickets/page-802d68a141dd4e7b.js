(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9239],{30498:(e,a,l)=>{"use strict";l.a(e,async(e,s)=>{try{l.r(a),l.d(a,{default:()=>b});var t=l(95155),r=l(12115),i=l(20063),d=l(22663),o=l(40989),c=l(43698),n=l(73424),u=l(30304),m=l(50412),p=l(49156),x=l(141),v=l(76465),g=l(90854),h=e([p,x,v,g]);function b(){let e=(0,i.useRouter)(),{user:a}=(0,g.A)(),[l,s]=(0,r.useState)([]),[h,b]=(0,r.useState)([]),[f,j]=(0,r.useState)(!0),[N,w]=(0,r.useState)(""),[y,k]=(0,r.useState)(1),[A,E]=(0,r.useState)(0),[S,C]=(0,r.useState)({}),[T,P]=(0,r.useState)(20),[R,I]=(0,r.useState)(!1),[O,M]=(0,r.useState)(null),[D,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{B()},[]);let B=async()=>{try{let e=await p.$p.empresa.list({perPage:1e3});b(e.data||[])}catch(e){console.error("Erro ao carregar empresas:",e)}},F=(0,r.useCallback)(async()=>{try{var e;j(!0);let a={page:y,perPage:T,search:N||void 0};S.status&&(a.status=S.status),S.tipo&&(a.tipo=S.tipo),S.prioridade&&(a.prioridade=S.prioridade),S.empresaId&&(a.empresaId=S.empresaId);let l=await p.$p.ticket.list(a);s(l.data||[]),E((null==(e=l.pagination)?void 0:e.totalPages)||1)}catch(e){console.error("Erro ao carregar tickets:",e),d.oR.error("Erro ao carregar tickets")}finally{j(!1)}},[y,S,T,N]);(0,r.useEffect)(()=>{F()},[F]);let G=e=>{C(a=>({...a,...e})),k(1)},L=async e=>{if(window.confirm("Tem certeza que deseja excluir este ticket?"))try{await p.$p.ticket.delete(e.id),d.oR.success("Ticket exclu\xeddo com sucesso"),F()}catch(e){var a,l;d.oR.error((null==e||null==(l=e.response)||null==(a=l.data)?void 0:a.error)||"Erro ao excluir ticket")}},U=async(e,a)=>{if(O){_(!0);try{await p.$p.ticket.update(O.id,{status:e.status,prioridade:e.prioridade}),d.oR.success("Ticket atualizado com sucesso"),I(!1),M(null),F()}catch(e){var l,s;d.oR.error((null==e||null==(s=e.response)||null==(l=s.data)?void 0:l.error)||"Erro ao atualizar ticket")}finally{_(!1)}}},$=[{value:"",label:"Todos"},{value:"ABERTO",label:"Aberto"},{value:"EM_ANDAMENTO",label:"Em Andamento"},{value:"RESOLVIDO",label:"Resolvido"},{value:"FECHADO",label:"Fechado"}],z=[{value:"",label:"Todos"},{value:"PROBLEMA",label:"Problema"},{value:"AJUDA",label:"Ajuda"},{value:"MELHORIA",label:"Melhoria"},{value:"SUGESTAO",label:"Sugest\xe3o"}],V=[{value:"",label:"Todas"},{value:"BAIXA",label:"Baixa"},{value:"MEDIA",label:"M\xe9dia"},{value:"ALTA",label:"Alta"},{value:"URGENTE",label:"Urgente"}],H=[{value:"",label:"Todas"},...h.map(e=>({value:e.id.toString(),label:e.nome}))];return(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Gerenciar Tickets"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Gerencie todos os tickets do sistema"})]})}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4 mb-6",children:[(0,t.jsx)("div",{className:"flex-1 w-full sm:max-w-xs",children:(0,t.jsx)(o.A,{type:"text",placeholder:"Buscar tickets...",value:N,onChange:e=>{w(e.target.value),k(1)},className:"w-full","aria-label":"Buscar tickets"})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsx)(c.A,{placeholder:"Status",options:$.filter(e=>""!==e.value),value:$.find(e=>e.value===(S.status||"")),onChange:e=>G({status:(null==e?void 0:e.value)||void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por status"}),(0,t.jsx)(c.A,{placeholder:"Tipo",options:z.filter(e=>""!==e.value),value:z.find(e=>e.value===(S.tipo||"")),onChange:e=>G({tipo:(null==e?void 0:e.value)||void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por tipo"}),(0,t.jsx)(c.A,{placeholder:"Prioridade",options:V.filter(e=>""!==e.value),value:V.find(e=>e.value===(S.prioridade||"")),onChange:e=>G({prioridade:(null==e?void 0:e.value)||void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por prioridade"}),(0,t.jsx)(c.A,{placeholder:"Empresa",options:H.filter(e=>""!==e.value),value:H.find(e=>{var a;return e.value===((null==(a=S.empresaId)?void 0:a.toString())||"")}),onChange:e=>G({empresaId:(null==e?void 0:e.value)?parseInt(e.value):void 0}),isClearable:!0,className:"whitespace-nowrap min-w-40","aria-label":"Filtrar por empresa"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsx)(u.A,{className:"flex items-center mb-0 h-full",children:"Quantidade por p\xe1gina"}),(0,t.jsx)(o.A,{className:"max-w-24",defaultValue:T,max:100,min:1,onChange:e=>{let a=Number(e.target.value)||9;P(a),k(1)},"aria-label":"Itens por p\xe1gina"})]}),A>1&&(0,t.jsx)(n.A,{currentPage:y,totalPages:A,onPageChange:k})]})]})]}),f?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"animate-pulse bg-gray-100 dark:bg-gray-800 rounded-lg h-48"},e))}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.length>0?l.map(a=>(0,t.jsx)(x.A,{ticket:a,onView:()=>{e.push("/dashboard/admin/tickets/".concat(a.id))},onEdit:()=>{M(a),I(!0)},onDelete:()=>L(a)},a.id)):(0,t.jsx)("div",{className:"col-span-full text-center py-12",children:(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhum ticket encontrado."})})}),A>1&&(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)("div",{className:"flex justify-end mb-4 gap-2 flex-wrap",children:(0,t.jsx)(n.A,{currentPage:y,totalPages:A,onPageChange:k})})}),O&&(0,t.jsx)(m.a,{isOpen:R,onClose:()=>{I(!1),M(null)},className:"max-w-2xl m-4",children:(0,t.jsx)("div",{className:"no-scrollbar relative w-full overflow-y-auto rounded-3xl bg-white p-4 dark:bg-gray-900 lg:p-11",children:(0,t.jsxs)("div",{className:"px-2 pr-14",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:"Editar Ticket"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"T\xedtulo:"}),(0,t.jsx)("p",{className:"text-sm text-gray-900 dark:text-white",children:O.titulo})]}),(0,t.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Descri\xe7\xe3o:"}),(0,t.jsx)("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:O.descricao})]}),(0,t.jsx)(v.A,{ticket:O,onSubmit:U,onCancel:()=>{I(!1),M(null)},loading:D,editMode:!0})]})]})})})]})}[p,x,v,g]=h.then?(await h)():h,s()}catch(e){s(e)}})},40577:(e,a,l)=>{Promise.resolve().then(l.bind(l,30498))}},e=>{e.O(0,[3598,2663,5889,7750,4691,1899,6895,8441,1255,7358],()=>e(e.s=40577)),_N_E=e.O()}]);