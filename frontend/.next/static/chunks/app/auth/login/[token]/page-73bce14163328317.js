(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5329],{2034:(e,t,a)=>{"use strict";a.d(t,{Ri:()=>o,cookies:()=>u});var n=a(57383),r=a(53060);let s=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=(0,r.WE)(),o=!!s&&"production"===s.apiEnv;n.A.set(e,t,{...a,secure:o,sameSite:"lax"})},o=e=>n.A.get(e),i=e=>{n.A.remove(e)},l={get:()=>o("token"),set:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s("token",e,t)},remove:()=>i("token")},c={get:()=>o("user"),set:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s("user",e,t)},remove:()=>i("user")},u={user:c,token:l,auth:{clear:()=>{c.remove(),l.remove()}}}},17671:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>d});var r=a(95155),s=a(12115),o=a(35695),i=a(67764),l=a(2034),c=a(13568),u=e([i]);function d(){let{token:e}=(0,o.useParams)(),t=(0,o.useRouter)(),[a,n]=(0,s.useState)(!0),[u,d]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{if(!e){d("Token n\xe3o fornecido"),n(!1);return}try{n(!0),d(null);let a=await i.y.loginByToken(e);if(a.message&&a.data){let{user:e,token:n}=a.data;c.Ay.success("Login realizado com sucesso!"),l.cookies.token.set(n),l.cookies.user.set(JSON.stringify(e)),await new Promise(e=>setTimeout(e,1e3));let r={SUPERADMIN:"/dashboard/admin",ADMIN:"/dashboard/empresa",GESTOR:"/dashboard/empresa",VENDEDOR:"/dashboard/empresa",CLIENTE:"/dashboard/cliente"}[e.role]||"/";setTimeout(()=>{t.push(r),setTimeout(()=>{window.location.reload()},1500)},1500)}else throw Error("Resposta inv\xe1lida do servidor")}catch(n){var a,r;console.error("Erro no login por token:",n);let e=(null===(r=n.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.error)||n.message||"Erro ao fazer login com o token";d(e),c.Ay.error(e),setTimeout(()=>{t.push("/auth/login")},3e3)}finally{n(!1)}})()},[e,t]),a)?(0,r.jsx)("div",{className:"flex flex-col flex-1 lg:w-1/2 w-full",children:(0,r.jsx)("div",{className:"w-full max-w-md sm:pt-10 mx-auto mb-5",children:(0,r.jsx)("div",{className:"flex flex-col justify-center flex-1 w-full max-w-md mx-auto",children:(0,r.jsxs)("div",{className:"mb-5 sm:mb-8",children:[(0,r.jsx)("h1",{className:"mb-2 font-semibold text-gray-800 text-title-sm dark:text-white/90 sm:text-title-md",children:"Fazendo login..."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Aguarde enquanto verificamos seu token de acesso."})]})})})}):u?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,r.jsx)("div",{className:"max-w-md w-full space-y-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto h-12 w-12 text-red-500",children:(0,r.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,r.jsx)("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900 dark:text-white",children:"Erro no Login"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:u}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:()=>t.push("/auth/login"),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Ir para Login"})}),(0,r.jsx)("p",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:"Voc\xea ser\xe1 redirecionado automaticamente em alguns segundos..."})]})})}):null}i=(u.then?(await u)():u)[0],n()}catch(e){n(e)}})},35695:(e,t,a)=>{"use strict";var n=a(18999);a.o(n,"useParams")&&a.d(t,{useParams:function(){return n.useParams}}),a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})},41134:(e,t,a)=>{Promise.resolve().then(a.bind(a,17671))},53060:(e,t,a)=>{"use strict";a.d(t,{WE:()=>c,yN:()=>u,zr:()=>d});var n=a(12115);let r=null,s=null,o=0,i={appName:"CobPanel",usarLandingPage:!1,apiEnv:"production",backendUrl:"http://localhost:5555"};async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return r&&!e&&t-o<3e5?r:s&&!e?s:s=fetch("/api/config",{cache:e?"no-cache":"default",headers:{"Content-Type":"application/json"}}).then(async e=>{if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));return e.json()}).then(e=>{let a={appName:e.appName||i.appName,usarLandingPage:!!e.usarLandingPage,apiEnv:e.apiEnv||i.apiEnv,backendUrl:e.backendUrl||i.backendUrl};return r=a,o=t,a}).catch(a=>r&&!e?r:(r=i,o=t,i)).finally(()=>{s=null})}function c(){return r}async function u(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return l(e)}function d(){let{config:e}=function(){let[e,t]=(0,n.useState)(r),[a,s]=(0,n.useState)(!r),[o,i]=(0,n.useState)(null),c=(0,n.useCallback)(async()=>{try{s(!0),i(null);let e=await l(!0);t(e)}catch(e){i(e instanceof Error?e.message:"Erro desconhecido")}finally{s(!1)}},[]);return(0,n.useEffect)(()=>{(!r||!r.backendUrl||r.backendUrl.includes("localhost"))&&l().then(t).catch(e=>{i(e instanceof Error?e.message:"Erro ao carregar configura\xe7\xe3o")}).finally(()=>s(!1))},[]),{config:e,loading:a,error:o,refreshConfig:c,isConfigured:!!r}}();return(null==e?void 0:e.backendUrl)||i.backendUrl}},67764:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.d(t,{y:()=>o});var r=a(71541),s=e([r]);r=(s.then?(await s)():s)[0];let o={login:async e=>(await r.FH.post("/auth/login",e)).data,loginByToken:async e=>(await r.FH.post("/auth/login/".concat(e))).data,register:async e=>(await r.FH.post("/auth/register",e)).data,getMe:async()=>(await r.FH.get("/auth/me")).data,changePassword:async e=>(await r.FH.post("/auth/change-password",e)).data,resetPassword:async e=>(await r.FH.post("/auth/reset-password",e)).data,validateToken:async e=>(await r.FH.post("/auth/validate-token",{token:e})).data};n()}catch(e){n(e)}})},71541:(e,t,a)=>{"use strict";a.a(e,async(e,n)=>{try{a.d(t,{FH:()=>e});var r=a(2034),s=a(23464),o=a(53060);async function i(){await (0,o.yN)(!0);let e=(0,o.WE)();if(null==e?void 0:e.backendUrl)return"".concat(e.backendUrl,"/api/v1");let t=(null==e?void 0:e.backendUrl)||"http://localhost:5555";return"".concat(t,"/api/v1")}let e=s.A.create({baseURL:await i(),headers:{"Content-Type":"application/json"}});e.interceptors.request.use(e=>{let t=r.cookies.token.get();return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),e.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)!==401||window.location.pathname.includes("/auth/login")||(r.cookies.auth.clear(),window.location.href="/auth/login"),Promise.reject(e)}),n()}catch(e){n(e)}},1)}},e=>{var t=t=>e(e.s=t);e.O(0,[8122,3568,8441,1684,7358],()=>t(41134)),_N_E=e.O()}]);