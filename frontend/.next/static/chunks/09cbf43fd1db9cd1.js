(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10248,e=>{"use strict";var t=e.i(59888);e.s(["ChevronLeftIcon",()=>t.default])},64255,e=>{"use strict";var t=e.i(43476);e.s(["default",0,({variant:e="light",color:r="primary",size:a="md",startIcon:s,className:i,endIcon:n,children:l})=>{let o={light:{primary:"bg-brand-50 text-brand-500 dark:bg-brand-500/15 dark:text-brand-400",success:"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500",error:"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500",warning:"bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400",info:"bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500",light:"bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80",dark:"bg-gray-500 text-white dark:bg-white/5 dark:text-white"},solid:{primary:"bg-brand-500 text-white dark:text-white",success:"bg-success-500 text-white dark:text-white",error:"bg-error-500 text-white dark:text-white",warning:"bg-warning-500 text-white dark:text-white",info:"bg-blue-light-500 text-white dark:text-white",light:"bg-gray-400 dark:bg-white/5 text-white dark:text-white/80",dark:"bg-gray-700 text-white dark:text-white"}}[e][r];return(0,t.jsxs)("span",{className:`inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full font-medium ${{sm:"text-theme-xs",md:"text-sm"}[a]} ${o} ${i}`,children:[s&&(0,t.jsx)("span",{className:"mr-1",children:s}),l,n&&(0,t.jsx)("span",{className:"ml-1",children:n})]})}])},15288,e=>{"use strict";var t=e.i(43476);let r=({children:e,className:r=""})=>(0,t.jsx)("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 ${r}`,children:e});e.s(["Card",()=>r])},11481,e=>e.a(async(t,r)=>{try{var a=e.i(43476),s=e.i(54338),i=e.i(57688),n=e.i(24925),l=t([s]);function o({mensagem:e}){let{user:t}=(0,s.useAuth)(),r=e.userId===t?.id,l=e.user?.role==="SUPERADMIN";return(0,a.jsx)("div",{className:`flex ${r?"justify-end":"justify-start"} mb-4`,children:(0,a.jsxs)("div",{className:`flex flex-col max-w-[70%] ${r?"items-end":"items-start"}`,children:[(0,a.jsxs)("div",{className:`flex items-center gap-2 mb-1 ${r?"flex-row-reverse":""}`,children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.user?.nome||"Usuário"}),l&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 font-medium",children:"ADMIN"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:function(e){try{let t=new Date(e),r=new Date,a=Math.floor((r.getTime()-t.getTime())/1e3);if(a<60)return"agora";if(a<3600)return`${Math.floor(a/60)} min atr\xe1s`;if(a<86400)return`${Math.floor(a/3600)} hr atr\xe1s`;let s=new Date;s.setHours(0,0,0,0);let i=new Date(t);if(i.setHours(0,0,0,0),i.getTime()===s.getTime())return`Hoje \xe0s ${t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`;let n=new Date(s);if(n.setDate(n.getDate()-1),i.getTime()===n.getTime())return`Ontem \xe0s ${t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`;return t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}(e.createdAt)})]}),e.anexos&&Array.isArray(e.anexos)&&e.anexos.length>0&&(0,a.jsx)("div",{className:`mt-2 ${r?"text-right":"text-left"}`,children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.anexos.map((e,t)=>{let s=e.tipo?.startsWith("image/"),l=(0,n.getAppConfig)(),o=e.url?`${l?.backendUrl}${e.url}`:"#";return console.log("fileUrl:",o),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[s?(0,a.jsx)("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"block",children:(0,a.jsx)(i.default,{src:o,alt:e.nome||`Anexo ${t+1}`,className:"max-w-[200px] max-h-[200px] rounded-lg object-cover border border-gray-200 dark:border-gray-600 hover:opacity-80 transition-opacity cursor-pointer",width:200,height:200})}):(0,a.jsxs)("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center gap-1 text-xs px-3 py-1.5 rounded-lg transition-colors ${r?"bg-blue-400/20 text-blue-100 hover:bg-blue-400/30":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"}`,children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),e.nome||`Anexo ${t+1}`]}),s&&(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate max-w-[200px]",children:e.nome||`Anexo ${t+1}`})]},t)})})}),(0,a.jsx)("div",{className:`rounded-2xl px-4 py-3 shadow-sm ${r?"bg-blue-500 text-white rounded-tr-sm":l?"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 text-gray-900 dark:text-white rounded-tl-sm":"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white rounded-tl-sm"}`,children:(0,a.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.mensagem})})]})})}[s]=l.then?(await l)():l,e.s(["default",()=>o]),r()}catch(e){r(e)}},!1),92744,e=>e.a(async(t,r)=>{try{var a=e.i(71645),s=e.i(18566),i=e.i(96085),n=e.i(76318),l=e.i(67833),o=e.i(5766),c=e.i(54338),d=e.i(24925),u=t([n,c]);function x(){(0,s.useRouter)();let{user:e,isAuthenticated:t}=(0,c.useAuth)(),r=(0,d.useBackendUrl)(),[u,x]=(0,a.useState)([]),[g,m]=(0,a.useState)(!0),[h,f]=(0,a.useState)(null),[k,p]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),v=(0,a.useRef)(!1);(0,a.useEffect)(()=>{let a=l.cookies.token.get();if(!a||!t||!e){f(e=>(e&&(e.close(),p(!1)),null)),v.current=!1;return}if(v.current)return;if(!r)return void console.warn("[Socket.IO] backendUrl não configurada");if(v.current)return;v.current=!0,console.log("[Socket.IO] Inicializando conexão com:",r);let s=(0,i.io)(r,{auth:{token:a},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:2e3,reconnectionAttempts:5,reconnectionDelayMax:5e3,timeout:2e4,forceNew:!1});return s.on("connect",()=>{console.log("[Socket.IO Tickets] Conectado"),p(!0)}),s.on("disconnect",()=>{console.log("[Socket.IO Tickets] Desconectado"),p(!1)}),s.on("connect_error",e=>{console.error("[Socket.IO Tickets] Erro de conexão:",e),p(!1)}),s.on("ticket:nova-mensagem",e=>{if(console.log("[Socket.IO Tickets] Nova mensagem recebida:",e),b!==e.ticketId){let t=e.ticket?.titulo||"Ticket";o.default.success(`Nova mensagem no ticket: ${t}`,{duration:5e3})}}),s.on("ticket:status-atualizado",e=>{console.log("[Socket.IO Tickets] Status atualizado:",e),x(t=>{let r=t.findIndex(t=>t.id===e.ticketId);if(r>=0){let a=[...t];return a[r]={...a[r],status:e.status},a}return t})}),f(s),()=>{s&&s.close(),v.current=!1}},[t,e,r]);let j=(0,a.useCallback)(async e=>{try{m(!0);let t=await n.services.ticket.list(e);x(t.data)}catch(e){console.error("Erro ao carregar tickets:",e),o.default.error("Erro ao carregar tickets")}finally{m(!1)}},[]),w=(0,a.useCallback)(async e=>{try{return(await n.services.ticket.getById(e)).data}catch(e){return console.error("Erro ao carregar ticket:",e),o.default.error("Erro ao carregar ticket"),null}},[]),N=(0,a.useCallback)(e=>{h&&k&&(h.emit("ticket:join",{ticketId:e}),y(e))},[h,k]),A=(0,a.useCallback)(e=>{h&&k&&(h.emit("ticket:leave",{ticketId:e}),b===e&&y(null))},[h,k,b]);return{tickets:u,loading:g,isConnected:k,currentTicketId:b,loadTickets:j,loadTicket:w,joinTicketRoom:N,leaveTicketRoom:A}}[n,c]=u.then?(await u)():u,e.s(["useTickets",()=>x]),r()}catch(e){r(e)}},!1),46788,e=>e.a(async(t,r)=>{try{var a=e.i(43476),s=e.i(71645),i=e.i(18566),n=e.i(5766),l=e.i(15288),o=e.i(90873),c=e.i(23115),d=e.i(67073),u=e.i(76318),x=e.i(11481),g=e.i(64255),m=e.i(52455);e.i(35829);var h=e.i(10248),f=e.i(92744),k=e.i(54338),p=e.i(24925),b=t([u,x,f,k]);function y(){let t=(0,i.useRouter)(),r=(0,i.useParams)(),{user:b}=(0,k.useAuth)(),{loadTicket:y,joinTicketRoom:v,leaveTicketRoom:j}=(0,f.useTickets)(),w=(0,p.useBackendUrl)(),[N,A]=(0,s.useState)(null),[E,S]=(0,s.useState)(!0),[C,M]=(0,s.useState)(""),[T,D]=(0,s.useState)(!1),[O,I]=(0,s.useState)([]),[R,B]=(0,s.useState)("ABERTO"),[L,$]=(0,s.useState)(!1),z=(0,s.useRef)(null),U=(0,s.useRef)(null),F=(0,s.useRef)(null),P=parseInt(r.id),H=(0,s.useCallback)(async()=>{try{S(!0);let e=await y(P);e?A(e):(n.toast.error("Ticket não encontrado"),t.push("/dashboard/empresa/tickets"))}catch(e){console.error("Erro ao carregar ticket:",e),n.toast.error("Erro ao carregar ticket"),t.push("/dashboard/empresa/tickets")}finally{S(!1)}},[y,P,t]);(0,s.useEffect)(()=>{if(P)return H(),v(P),(async()=>{let{cookies:t}=await e.A(25617),r=t.token.get();if(w&&r){let{io:t}=await e.A(22025),a=t(w,{auth:{token:r},transports:["websocket","polling"]});a.on("ticket:nova-mensagem",e=>{e.ticketId===P&&e.ticket&&A(e.ticket)}),a.on("ticket:status-atualizado",e=>{e.ticketId===P&&A(t=>t?{...t,status:e.status}:null)}),U.current=a}})(),()=>{j(P),U.current&&U.current.close()}},[P,H,v,j,w]),(0,s.useEffect)(()=>{N?.mensagens&&N.mensagens.length>0&&z.current?.scrollIntoView({behavior:"smooth"})},[N?.mensagens]),(0,s.useEffect)(()=>{N&&B(N.status)},[N]);let V=async e=>{if(e.preventDefault(),C.trim()||0!==O.length){D(!0);try{let e=C.trim()||(O.length>0?"Anexos enviados":"");await u.services.ticket.addMensagem(P,{mensagem:e},O.length>0?O:void 0),M(""),I([]),F.current&&(F.current.value=""),n.toast.success("Mensagem enviada com sucesso"),await H()}catch(e){n.toast.error(e?.response?.data?.error||"Erro ao enviar mensagem")}finally{D(!1)}}},W=async()=>{if(N&&N.status!==R){$(!0);try{await u.services.ticket.update(N.id,{status:R}),n.toast.success("Status do ticket atualizado com sucesso"),await H()}catch(e){n.toast.error(e?.response?.data?.error||"Erro ao atualizar status do ticket")}finally{$(!1)}}},_=b?.id===N?.criadorId,q=[{value:"ABERTO",label:"Aberto"},{value:"EM_ANDAMENTO",label:"Em Andamento"},{value:"RESOLVIDO",label:"Resolvido"},{value:"FECHADO",label:"Fechado"}];return E?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Carregando ticket..."})}):N?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(o.default,{variant:"outline",onClick:()=>t.push("/dashboard/empresa/tickets"),startIcon:(0,a.jsx)(h.ChevronLeftIcon,{className:"w-5 h-5"}),"aria-label":"Voltar para lista de tickets",children:"Voltar"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:N.titulo}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[(0,a.jsx)(g.default,{color:function(e){switch(e){case"ABERTO":default:return"info";case"EM_ANDAMENTO":return"warning";case"RESOLVIDO":return"success";case"FECHADO":return"error"}}(N.status),children:function(e){switch(e){case"ABERTO":return"Aberto";case"EM_ANDAMENTO":return"Em Andamento";case"RESOLVIDO":return"Resolvido";case"FECHADO":return"Fechado";default:return e}}(N.status)}),(0,a.jsx)(g.default,{color:"info",children:function(e){switch(e){case"PROBLEMA":return"Problema";case"AJUDA":return"Ajuda";case"MELHORIA":return"Melhoria";case"SUGESTAO":return"Sugestão";default:return e}}(N.tipo)}),(0,a.jsx)(g.default,{color:"warning",children:function(e){switch(e){case"BAIXA":return"Baixa";case"MEDIA":return"Média";case"ALTA":return"Alta";case"URGENTE":return"Urgente";default:return e}}(N.prioridade)})]})]})]}),(0,a.jsx)(l.Card,{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descrição:"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 whitespace-pre-wrap",children:N.descricao})]}),_&&(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)(c.default,{htmlFor:"status",children:"Status do Ticket"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,a.jsx)(d.default,{id:"status",options:q,value:q.find(e=>e.value===R),onChange:e=>B(e?.value||"ABERTO"),isSearchable:!1,className:"flex-1","aria-label":"Status do ticket"}),(0,a.jsx)(o.default,{type:"button",variant:"primary",onClick:W,disabled:L||N.status===R,"aria-label":"Atualizar status",children:L?"Atualizando...":"Atualizar Status"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Criado por:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:N.criador?.nome||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Data de criação:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:(0,m.formatDate)(N.createdAt)})]})]})]})}),(0,a.jsxs)(l.Card,{className:"p-0 overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Mensagens (",N.mensagens?.length||0,")"]})}),(0,a.jsx)("div",{className:"px-6 py-4 max-h-[600px] min-h-[400px] overflow-y-auto bg-gray-50 dark:bg-gray-900/50",children:N.mensagens&&N.mensagens.length>0?(0,a.jsxs)(a.Fragment,{children:[N.mensagens.map(e=>(0,a.jsx)(x.default,{mensagem:e},e.id)),(0,a.jsx)("div",{ref:z})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full min-h-[300px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma mensagem ainda. Seja o primeiro a comentar!"})]})})}),(0,a.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:(0,a.jsxs)("form",{onSubmit:V,className:"space-y-3",children:[O.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm",children:[(0,a.jsxs)("span",{className:"text-gray-700 dark:text-gray-300 truncate max-w-[200px]",children:[e.name," (",(e.size/1024/1024).toFixed(2)," MB)"]}),(0,a.jsx)("button",{type:"button",onClick:()=>{I(e=>e.filter((e,r)=>r!==t))},className:"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 ml-1","aria-label":`Remover ${e.name}`,children:"✕"})]},t))}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{id:"mensagem",value:C,onChange:e=>M(e.target.value),rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none",placeholder:"Digite sua mensagem...","aria-label":"Mensagem do ticket",onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),(C.trim()||O.length>0)&&!T&&V(e))}})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("input",{ref:F,type:"file",multiple:!0,onChange:e=>{if(e.target.files){let t=Array.from(e.target.files);if(t.length>5)return void n.toast.error("Máximo de 5 arquivos permitidos");I(t)}},accept:"image/*,application/pdf,.doc,.docx,.xls,.xlsx,.txt,.csv",className:"hidden","aria-label":"Anexar arquivos",id:"file-input-ticket"}),(0,a.jsx)(o.default,{type:"button",variant:"outline",className:"h-full flex items-center justify-center","aria-label":"Anexar arquivo",onClick:()=>F.current?.click(),children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,a.jsx)(o.default,{type:"submit",variant:"primary",disabled:T||!C.trim()&&0===O.length,className:"h-full flex items-center justify-center","aria-label":"Enviar mensagem",children:T?(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Máximo 5 arquivos, 10MB cada. Formatos: imagens, PDFs, documentos do Office, textos."})]})})]})]}):null}[u,x,f,k]=b.then?(await b)():b,e.s(["default",()=>y]),r()}catch(e){r(e)}},!1),25617,e=>{e.v(e=>Promise.resolve().then(()=>e(67833)))},22025,e=>{e.v(t=>Promise.all(["static/chunks/1fd1c921537d30cb.js"].map(t=>e.l(t))).then(()=>t(92032)))}]);